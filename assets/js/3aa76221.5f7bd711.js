"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[831],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},b=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(a),b=r,m=p["".concat(s,".").concat(b)]||p[b]||d[b]||o;return a?n.createElement(m,i(i({ref:t},u),{},{components:a})):n.createElement(m,i({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=b;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}b.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(7294),r=a(6010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:a,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,i),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>N});var n=a(7462),r=a(7294),o=a(6010),i=a(2466),l=a(6550),s=a(1980),c=a(7392),u=a(12);function p(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function d(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??p(a);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function b(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:a}=e;const n=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,s._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(n.location.search);t.set(o,e),n.replace({...n.location,search:t.toString()})}),[o,n])]}function h(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,o=d(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!b({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:o}))),[s,c]=m({queryString:a,groupId:n}),[p,h]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,o]=(0,u.Nk)(a);return[n,(0,r.useCallback)((e=>{a&&o.set(e)}),[a,o])]}({groupId:n}),f=(()=>{const e=s??p;return b({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{f&&l(f)}),[f]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!b({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),c(e),h(e)}),[c,h,o]),tabValues:o}}var f=a(2389);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function g(e){let{className:t,block:a,selectedValue:l,selectValue:s,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),d=e=>{const t=e.currentTarget,a=u.indexOf(t),n=c[a].value;n!==l&&(p(t),s(n))},b=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=u.indexOf(e.currentTarget)+1;t=u[a]??u[0];break}case"ArrowLeft":{const a=u.indexOf(e.currentTarget)-1;t=u[a]??u[u.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":a},t)},c.map((e=>{let{value:t,label:a,attributes:i}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>u.push(e),onKeyDown:b,onClick:d},i,{className:(0,o.Z)("tabs__item",y.tabItem,i?.className,{"tabs__item--active":l===t})}),a??t)})))}function k(e){let{lazy:t,children:a,selectedValue:n}=e;if(a=Array.isArray(a)?a:[a],t){const e=a.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function v(e){const t=h(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",y.tabList)},r.createElement(g,(0,n.Z)({},e,t)),r.createElement(k,(0,n.Z)({},e,t)))}function N(e){const t=(0,f.Z)();return r.createElement(v,(0,n.Z)({key:String(t)},e))}},9603:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var n=a(7462),r=(a(7294),a(3905));a(5162),a(4866);const o={description:"Working With Couchbase Lite Databases With Dart",related_content:[{name:"Blobs",url:"/blobs"},{name:"Documents",url:"/documents"},{name:"Indexing",url:"/indexing"}]},i="Databases",l={unversionedId:"databases",id:"databases",title:"Databases",description:"Working With Couchbase Lite Databases With Dart",source:"@site/docs/databases.mdx",sourceDirName:".",slug:"/databases",permalink:"/databases",draft:!1,editUrl:"https://github.com/cbl-dart/cbl-dart/tree/main/docs/docs/databases.mdx",tags:[],version:"current",frontMatter:{description:"Working With Couchbase Lite Databases With Dart",related_content:[{name:"Blobs",url:"/blobs"},{name:"Documents",url:"/documents"},{name:"Indexing",url:"/indexing"}]},sidebar:"sidebar",previous:{title:"General Concepts",permalink:"/general-concepts"},next:{title:"Pre-built Database",permalink:"/prebuilt-database"}},s={},c=[{value:"Database Concepts",id:"database-concepts",level:2},{value:"Create or Open Database",id:"create-or-open-database",level:2},{value:"Close Database",id:"close-database",level:2},{value:"Database Encryption",id:"database-encryption",level:2},{value:"Enabling",id:"enabling",level:3},{value:"Persiting",id:"persiting",level:3},{value:"Opening",id:"opening",level:3},{value:"Changing",id:"changing",level:3},{value:"Removing",id:"removing",level:3},{value:"Database Maintenance",id:"database-maintenance",level:2},{value:"Command Line Tool",id:"command-line-tool",level:2},{value:"Couchbase Lite for VSCode",id:"couchbase-lite-for-vscode",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}],u=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},p=u("Table"),d=u("CodeExample"),b=u("APITabs"),m=u("APITab"),h=u("EnterpriseFeatureCallout"),f={toc:c},y="wrapper";function g(e){let{components:t,...a}=e;return(0,r.kt)(y,(0,n.Z)({},f,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"databases"},"Databases"),(0,r.kt)("metaheader",null),(0,r.kt)("h2",{id:"database-concepts"},"Database Concepts"),(0,r.kt)("p",null,"Databases created on Couchbase Lite can share the same hierarchical structure as\nCapella databases. This makes it easier to sync data between mobile applications\nand applications built using Capella."),(0,r.kt)("p",null,"Although the terminology is different, the structure can be mapped to relational\ndatabase terms:"),(0,r.kt)(p,{id:1,title:"Relational Database \u2192 Couchbase",mdxType:"Table"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Relational database"),(0,r.kt)("th",{parentName:"tr",align:null},"Couchbase"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Database"),(0,r.kt)("td",{parentName:"tr",align:null},"Database")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Schema"),(0,r.kt)("td",{parentName:"tr",align:null},"Scope")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Table"),(0,r.kt)("td",{parentName:"tr",align:null},"Collection"))))),(0,r.kt)("p",null,"This structure gives you plenty of choices when it comes to partitioning your\ndata. The most basic structure is to use the single default scope with a single\ndefault collection; or you could opt for a structure that allow you to split\nyour collections into logical scopes."),(0,r.kt)("admonition",{title:"Storing local configuration",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You may not need to sync all the data related for a particular application. You\ncan set up a scope that syncs data, and a second scope that doesn't."),(0,r.kt)("p",{parentName:"admonition"},"One reason for doing this is to store local configuration data (such as the\npreferred screen orientation or keyboard layout). Since this information only\nrelates to a particular device, there is no need to sync it:"),(0,r.kt)("table",{parentName:"admonition"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Data","\xa0","Scope"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"local"),(0,r.kt)("td",{parentName:"tr",align:null},"Contains information pertaining to the device.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"syncing"),(0,r.kt)("td",{parentName:"tr",align:null},"Contains information pertaining to the user, which can be synced back to the cloud for use on the web or another device."))))),(0,r.kt)("h2",{id:"create-or-open-database"},"Create or Open Database"),(0,r.kt)("p",null,"You can create a new database and-or open an existing database, using the\n",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/Database-class.html"},(0,r.kt)("inlineCode",{parentName:"a"},"Database"))," class. The database class provides both synchronous and\nasynchronous methods for opening and closing databases (see\n",(0,r.kt)("a",{parentName:"p",href:"/general-concepts#sync-and-async-apis"},"explanation for Synchronous and Asynchronous APIs"),").\nJust pass in a database name and optionally a ",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/DatabaseConfiguration-class.html"},(0,r.kt)("inlineCode",{parentName:"a"},"DatabaseConfiguration"))," - see\n",(0,r.kt)("a",{parentName:"p",href:"#example-1"},"Example 1"),"."),(0,r.kt)("p",null,"Things to watch for include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If the named database does not exist in the specified, or default, location\nthen a new one is created.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The database is created in a default location unless you specify a directory\nfor it \u2014 see: ",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/DatabaseConfiguration/directory.html"},(0,r.kt)("inlineCode",{parentName:"a"},"DatabaseConfiguration.directory")),"."),(0,r.kt)("admonition",{parentName:"li",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Best Practice is to always specify the path to the database explicitly.")),(0,r.kt)("p",{parentName:"li"},"See ",(0,r.kt)("a",{parentName:"p",href:"/supported-platforms"},"Supported Platforms")," for the default location\nfor each platform."))),(0,r.kt)(d,{id:1,title:"Opening a Database",mdxType:"CodeExample"},(0,r.kt)(b,{mdxType:"APITabs"},(0,r.kt)(m,{api:"Async",mdxType:"APITab"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dart"},"final database = await Database.openAsync('my-database');\n"))),(0,r.kt)(m,{api:"Sync",mdxType:"APITab"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dart"},"final database = Database.openSync('my-database');\n"))))),(0,r.kt)("h2",{id:"close-database"},"Close Database"),(0,r.kt)("p",null,"You are advised to incorporate the closing of all open database into your\napplication workflow."),(0,r.kt)("p",null,"Closing a database is simple, just call use ",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/Database/close.html"},(0,r.kt)("inlineCode",{parentName:"a"},"Database.close")),". See\n",(0,r.kt)("a",{parentName:"p",href:"#example-2"},"Example 2"),". This also closes active replications, listeners, and-or live\nqueries connected to the database."),(0,r.kt)(d,{id:2,title:"Closing a Database",mdxType:"CodeExample"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dart"},"await database.close();\n"))),(0,r.kt)("h2",{id:"database-encryption"},"Database Encryption"),(0,r.kt)(h,{mdxType:"EnterpriseFeatureCallout"}),(0,r.kt)("p",null,"Couchbase Lite includes the ability to encrypt Couchbase Lite databases. This\nallows mobile applications to secure data at rest, when it is being stored on\nthe device. The algorithm used to encrypt the database is 256-bit AES."),(0,r.kt)("h3",{id:"enabling"},"Enabling"),(0,r.kt)("p",null,"To enable encryption, use ",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/DatabaseConfiguration/encryptionKey.html"},(0,r.kt)("inlineCode",{parentName:"a"},"DatabaseConfiguration.encryptionKey"))," to set the\nencryption key of your choice. Provide this encryption key every time the\ndatabase is opened - see ",(0,r.kt)("a",{parentName:"p",href:"#example-3"},"Example 3"),"."),(0,r.kt)(d,{id:3,title:"Opening an Encrypted Database",mdxType:"CodeExample"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dart"},"final key = await EncryptionKey.passwordAsync('secret password');\nfinal config = DatabaseConfiguration(encryptionKey: key);\nfinal database = await Database.openAsync('my-database', config);\n"))),(0,r.kt)("h3",{id:"persiting"},"Persiting"),(0,r.kt)("p",null,"Couchbase Lite does not persist the key. It is the application's responsibility\nto manage the key and store it in a platform specific secure store such as\nApple's\n",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/security/keychain_services"},"Keychain"),"\nor Android's\n",(0,r.kt)("a",{parentName:"p",href:"https://developer.android.com/training/articles/keystore"},"Keystore"),"."),(0,r.kt)("h3",{id:"opening"},"Opening"),(0,r.kt)("p",null,"An encrypted database can only be opened with the same language SDK that was\nused to encrypt it in the first place. So a database encrypted using the Dart\nSDK, and then exported, is readable only by the Dart or C SDK."),(0,r.kt)("h3",{id:"changing"},"Changing"),(0,r.kt)("p",null,"To change an existing encryption key, open the database using its existing\nencryption-key and use ",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/Database/changeEncryptionKey.html"},(0,r.kt)("inlineCode",{parentName:"a"},"Database.changeEncryptionKey"))," to set the required\nnew encryption-key value."),(0,r.kt)("h3",{id:"removing"},"Removing"),(0,r.kt)("p",null,"To remove encryption, open the database using its existing encryption-key and\nuse ",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/Database/changeEncryptionKey.html"},(0,r.kt)("inlineCode",{parentName:"a"},"Database.changeEncryptionKey"))," with a ",(0,r.kt)("inlineCode",{parentName:"p"},"null")," value as the encryption\nkey."),(0,r.kt)("h2",{id:"database-maintenance"},"Database Maintenance"),(0,r.kt)("p",null,"From time to time it may be necessary to perform certain maintenance activities\non your database, for example to compact the database file, removing unused\ndocuments and blobs no longer referenced by any documents."),(0,r.kt)("p",null,"Couchbase Lite's API provides the ",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/Database/performMaintenance.html"},(0,r.kt)("inlineCode",{parentName:"a"},"Database.performMaintenance"))," method. The\navailable maintenance operations, including compact are as shown in the enum\n",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/MaintenanceType.html"},(0,r.kt)("inlineCode",{parentName:"a"},"MaintenanceType"))," to accomplish this."),(0,r.kt)("p",null,"This is a resource intensive operation and is not performed automatically. It\nshould be run on-demand using the API. If in doubt, consult Couchbase support."),(0,r.kt)("h2",{id:"command-line-tool"},"Command Line Tool"),(0,r.kt)("p",null,"cblite is a command-line tool for inspecting and querying Couchbase Lite\ndatabases."),(0,r.kt)("p",null,"You can download and build it from the couchbaselabs\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/couchbaselabs/couchbase-mobile-tools/blob/master/README.cblite.md"},"GitHub repository"),".\nNote that the cblite tool is not supported by the\n",(0,r.kt)("a",{parentName:"p",href:"https://www.couchbase.com/support-policy"},"Couchbase Support Policy"),"."),(0,r.kt)("h2",{id:"couchbase-lite-for-vscode"},"Couchbase Lite for VSCode"),(0,r.kt)("p",null,"Couchbase Lite for VSCode is a Visual Studio Code extension that provides a user\ninterface for inspecting and querying Couchbase Lite databases. You can find\nmore information about this extension from it's\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/couchbaselabs/vscode-cblite"},"GitHub repository"),"."),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("p",null,"You should use console logs as your first source of diagnostic information. If\nthe information in the default logging level is insufficient you can focus it on\ndatabase errors and generate more verbose messages (see ",(0,r.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/cbl/latest/cbl/LogLevel.html"},(0,r.kt)("inlineCode",{parentName:"a"},"LogLevel")),")\n\u2014\u2009see: ",(0,r.kt)("a",{parentName:"p",href:"#example-4"},"Example 4"),"."),(0,r.kt)(d,{id:4,title:"Increase level of Database Log Messages",mdxType:"CodeExample"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-dart"},"Database.log.console.level = LogLevel.verbose;\n"))))}g.isMDXComponent=!0}}]);
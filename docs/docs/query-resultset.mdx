---
description: How to use Couchbase Lite Query's Result Sets
related_content:
#todo replace database with live queries 
  - name: SQL ++ for Mobile 
    url: /sqlplusplus-mobile
  - name: QueryBuilder 
    url: /querybuilder
  - name: Indexes 
    url: /indexing
---

# Query Result Sets

## Query Execution
The execution of a Couchbase Lite for dart's database query returns an array of results, a result set.

Each row of the result set represents the data returned from a document that met the conditions defined by the WHERE statement of your query. The composition of each row is determined by the SelectResult expressions provided in the SELECT statement.

## Returned Results

The types of SelectResult formats you may encounter include those generated by the following:
- QueryBuilder.select(SelectResult.all()) — Using All 
- QueryBuilder.select(SelectResult.expression(Meta.id)) — Using Doc Id Metadata such as the _id 
- QueryBuilder.select(SelectResult.property("myProp")) — Using Specific Properties

### Return All Document Properties 

The SelectResult returned by SelectResult.all() is a dictionary object, with the database name as the key and the document properties as an array of key-value pairs.
<CodeExample id={1} title="Returning All Properties">

```json
[
  {
    "travel-sample": { 
      "callsign": "MILE-AIR",
      "country": "United States",
      "iata": "Q5",
      "icao": "MLA",
      "id": 10,
      "name": "40-Mile Air",
      "type": "airline"
    }
  },
  {
    "travel-sample": { 
      "callsign": "ALASKAN-AIR",
      "country": "United States",
      "iata": "AA",
      "icao": "AAA",
      "id": 10,
      "name": "Alaskan Airways",
      "type": "airline"
    }
  }
]
```
</CodeExample>

### Return Document Id Only
The SelectResult returned by queries using a SelectResult expression of the form SelectResult.expression(Meta.id) comprises a dictionary object with ID as the key and the ID value as the value.

<CodeExample id={2} title="Returning Meta Properties — Document ID">

```json
[
  {
    "id": "hotel123"
  },
  {
    "id": "hotel456"
  },
]
```
</CodeExample>


### Return Specific Properties Only
The SelectResult returned by queries using one or more SelectResult expressions of the form SelectResult.expression(property('name')) ) comprises a key-value pair for each SelectResult expression in the query. The key being the property name.

<CodeExample id={3} title="Returning Specific Properties">

```json
[
  { 
    "id": "hotel123",
    "type": "hotel",
    "name": "Hotel Ghia"
  },
  { 
    "id": "hotel456",
    "type": "hotel",
    "name": "Hotel Deluxe",
  }
]
```
</CodeExample>

## Processing Results
To retrieve the results of your query, you need to execute it using Query.execute.

The output from the execution is an array, with each array element representing the data from a document that matched your search criteria.

To unpack the results you need to iterate through this array. Alternatively, you can convert the result to a JSON string.

### Access Document Properties - All Properties
Here we look at how to access document properties when you have used SelectResult.all.

In this case each array element is a dictionary structure with the database name as its key. The properties are presented in the value as an array of key-value pairs (property name/property value).

You access the retrieved document properties by converting each row's value, in turn, to a dictionary — as shown in Example 4.

<CodeExample id={4} title="Returning Specific Properties">

```dart
final results = await query.execute();
for (var row in await results.allResults()) {
  final docsProps = row.dictionary(0);
  if (docsProps != null) {
    final docId = docsProps.string('id');
    final name = docsProps.string('name');
    final type = docsProps.string('type');
    final city = docsProps.string('city');
    print("$docId $name $type $city");
  }
}
```

1. Here we get the dictionary of document properties using the database name as the key. You can add this dictionary to an array of returned matches, for processing elsewhere in the app.
2. Alternatively, you can access the document properties here, by using the property names as keys to the dictionary object.

</CodeExample>

### Access Document Properties - ID
Here we look at how to access document properties when you have returned only the document IDs for documents that matched your selection criteria.

This is something you may do when retrieval of the properties directly by the query may consume excessive amounts of memory and-or processing time.

In this case each array element is a dictionary structure where ID is the key and the required document ID is the value.

Access the required document properties by retrieving the document from the database using its document ID — as shown in Example 5.

<CodeExample id={5} title="Access by ID">

```dart
final results = await query.execute();
for (var row in await results.allResults()) {
  final docId = row.string('metaId');
  final doc = await database.document(docId);
  if (doc != null){
    final hotelId = doc.string('id');
    final name = doc.string('name'); 
    final city = doc.string('city');
    final type = doc.string('type');
    //do something with variables 
  }
}
```

1. Extract the Id value from the dictionary and use it to get the document from the database
 
</CodeExample>

### Access Document Properties - Selected Properties

Here we look at how to access properties when you have used SelectResult to get a specific subset of properties.

In this case each array element is an array of key value pairs (property name/property value).

Access the retrieved properties by converting each row into a dictionary — as shown in Example 6. 

<CodeExample id={6} title="Selected Properties">

```dart
final results = await query.execute();
for (var row in await results.allResults()) {
  final docId = row.string('metaId');
  final id = row.string('id');
  final hotel = Hotel(id); 
  hotel.name = row.string('name'); 
  hotel.city = row.string('city');
  hotel.type = row.string('type');
  //do something with hotel ...
}
```

</CodeExample>

## JSON Result Sets

<CodeExample id={7} title="Using JSON Results">

:::tip
In dart/flutter you can use code generators to auto generate the code for handing serialization. See Creating model classes the json serializable way for more information. The example below shows how this can be done using the class Hotel with methods generated from the code generators. Also note when updating your model classes you will be required to run this command from the terminal to update your code generated classes:

flutter pub run build_runner build --delete-conflicting-outputs
:::

Use result.toPlainMap() to transform your result string into a map, which can easily be serialized or used as required in your application. See Example 7 for a working example.

```dart
// hotel.dart
// -------------------
// part 'hotel.g.dart';
// @JsonSerializable(explicitToJson: true)
// class Hotel {
//   String id; 
//   String type; 
//   String name;
//   String city; 
//   String country;
//   String? description; 
//   String? text; 
//   ... other class content
//   Hotel(
//    {required this.id,
//     required this.name,
//     required this.city,
//     required this.country,
//     required this.description,
//     required this.text);
//  factory Hotel.fromJson(Map<String, dynamic> json) => _$HotelFromJson(json);
//  Map<String, dynamic> toJson() => _$HotelToJson(this);
// }
//
// hotel_dao.dart
// -----------------
// part 'warehouse_dao.g.dart';
//@JsonSerializable(explicitToJson: true)
//class HotelDao {
//  final Hotel hotel;
//  const HotelDao(this.hotel);
//
//  factory HotelDao.fromJson(Map<String, dynamic> json) =>
//      _$HotelDaoFromJson(json);
//
//  Map<String, dynamic> toJson() => _$HotelDaoToJson(this);
//}
//
//
final database = await Database.openAsync('hotels');
final query = QueryBuilder.createAsync()
 .select(
    SelectResult.all().as('hotel'))
 .from(DataSource.database(database));
final results = await query.execute();
final results = await result.allResults();
for (var r in results) {
  final map = r.toPlainMap(); 
  final hotelDao = HotelDao.fromJson(map); 
  final hotel = hotelDao.hotel;
  //do something with hotel object
}
```

</CodeExample>

#### JSON String Format

<CodeExample id={8} title="selects ALL JSON format">

If your query selects ALL then the JSON format will be:

```json
{
  database-name: {
    key1: "value1",
    keyx: "valuex"
  }
}
```
</CodeExample>

<CodeExample id={9} title="selects sub-set format">

If your query selects a sub-set of available properties then the JSON format will be:

```json
{
  key1: "value1",
  keyx: "valuex"
}
```
</CodeExample>